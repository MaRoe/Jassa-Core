<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Jassa-Core Source: facete/PathUtils.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Jassa-Core</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Cache.html">Cache</a>
						</li>
						
						<li>
							<a href="Cache.BasicCacheStorage.html">BasicCacheStorage</a>
						</li>
						
						<li>
							<a href="Cache.LocalStorageCacheStorage.html">LocalStorageCacheStorage</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: facete/PathUtils.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">var _ = require('lodash');
//var uniq = require('lodash.uniq');

var NodeFactory = require('../rdf/NodeFactory');

var FacetNode = require('./FacetNode');
var VarUtils = require('../sparql/VarUtils');
var ElementUtils = require('../sparql/ElementUtils');
var Relation = require('../sparql/Relation');
var NodeUtils = require('../rdf/NodeUtils');
var StringUtils = require('../util/StringUtils');


var PathUtils = {
    createRelation: function(path, sourceVar) {
        sourceVar = sourceVar || VarUtils.s;
        var facetNode = FacetNode.createRoot(sourceVar);

        var fn = facetNode.forPath(path);
        var tmp = fn.getElements();

        var element = ElementUtils.groupIfNeeded(tmp);

        //var sourceVar = facetNode.getVar();
        var targetVar = fn.getVar();

        var result = new Relation(element, sourceVar, targetVar);
        return result;
    },


    getUris: function(path) {
        var steps = path ? path.getSteps(): [];

        var propertyUris = steps.map(function(step) {
            return step.getPropertyName();
        });

        var result = _.uniq(propertyUris);

        //var result = propertyUris.map(NodeFactory.createUri);
        return result;
    },

    getNodes: function(path) {
        var uris = PathUtils.getUris(path);
        var result = uris.map(NodeFactory.createUri);
        return result;
    },

    getNodesFromPaths: function(paths) {
        // Get all unique mentioned property names and turn them to jassa nodes
        var nodesArr = paths.map(function(path) {
            var r = PathUtils.getNodes(path);
            return r;
        });

        var nodes = _.flatten(nodesArr);
        var result = NodeUtils.uniq(nodes);
        return result;
    },


    /**
     * Passes an array of items to a lookup service and returns a promise
     * to an array with the original items matched with their lookup
     * value
     *
     * @param lookupService
     * @param items
     * @param keyFn
     * @returns
     */
/*
    zip: function(lookupService, items, keyFn) {
        var keys = items.map(keyFn || identity);
        var result = lookupService.lookup(keys).then(function(map) {
            var r = [];

            for(var i = 0; i &lt; items.length; ++i) {
                var item = items[i];
                var key = keys[i];
                var val = map.get(key);

                //var s = [item, val];
                var s = {
                    item: item,
                    key: key,
                    val: val
                };

                r.push(s);
            }

            return r;
        });

        return result;
    },

    createLabel: function(path, lookupService, emptyLabel, invertFn, stepSepataor) {

        foo.chain(arr).mapAsync(function(key) { lookupService.lookup(key)})

        // zipLookup: for each item get the key and make the lookup



    },

    createLabelHtml: function(path, nodeToLabelInfo) {
        var invertFn = StringUtils.createFnSuffix('&amp;sup1', true);
        var stepSeparator = '&amp;raquo';


        var r = defaultPathLabelHtmlFn(path, nodeToLabelInfo, 'Items', invertFn, stepSeparator);
        return r;
    },
*/
    createLabelFn: function(emptyLabel, invertFnOrStr, stepSeparator) {

        var result = function(path, nodeToLabelInfo) {
            var r = PathUtils.createLabel(path, nodeToLabelInfo, emptyLabel, invertFnOrStr, stepSeparator);
            return r;
        };

        return result;
    },

    createLabel: function(path, nodeToLabelInfo, emptyLabel, invertFnOrStr, stepSeparator) {

        emptyLabel = emptyLabel || 'Items';
        invertFnOrStr = invertFnOrStr || '^-1:';
        stepSeparator = stepSeparator || ' ';

        var invertFn = _.isFunction(invertFnOrStr) ? invertFnOrStr : StringUtils.parseAffixFn(invertFnOrStr);

        var steps = path.getSteps();
        var stepLabels = steps.map(function(step) {

            var property = NodeFactory.createUri(step.getPropertyName());
            var labelInfo = nodeToLabelInfo.get(property);
            var r = labelInfo.displayLabel || '(no label available)'; // TODO Probably the nullLabel is not needed, because the nodeToLabel map should take care of that

            if(step.isInverse()) {
                r = invertFn(r);
            }

            return r;
        });

        var result = stepLabels.join(stepSeparator);
        if(result === '') {
            result = emptyLabel;
        }

        return result;
    }


};


module.exports = PathUtils;
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					AKSW
					<br />
					
					
		<span class="copyright">
		AKSW 2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Sun Apr 19 2015 19:44:26 GMT+0000 (UTC) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
