<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Jassa-Core Source: sponate/SponateUtils.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Jassa-Core</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Cache.html">Cache</a>
						</li>
						
						<li>
							<a href="Cache.BasicCacheStorage.html">BasicCacheStorage</a>
						</li>
						
						<li>
							<a href="Cache.LocalStorageCacheStorage.html">LocalStorageCacheStorage</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: sponate/SponateUtils.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript linenums">var ObjectUtils = require('../util/ObjectUtils');
var PrefixUtils = require('../util/PrefixUtils');

var Element = require('../sparql/element/Element');
var ElementString = require('../sparql/element/ElementString');

var TemplateParser = require('./TemplateParser');

var ListServiceUtils = require('./ListServiceUtils');
var AggMap = require('./agg/AggMap');
var MappedConcept = require('./MappedConcept');
var ExprVar = require('../sparql/expr/ExprVar');

var Concept = require('../sparql/Concept');

var AggUtils = require('./AggUtils');

var SponateUtils = {



    /**
     * Parses a sponate mapping spec object into a MappedConcept.
     *
     */
    parseSpec: function(spec, prefixMapping, templateParser) {
        var template = spec.template;

        var result
            = (template instanceof MappedConcept)
            ? template
            : this.parseSpecCore(spec, prefixMapping, templateParser)
            ;

        return result;
    },

    parseSpecCore: function(spec, prefixMapping, templateParser) {

        templateParser = templateParser || new TemplateParser();

        var template = spec.template;
        var from = spec.from;

        // Parse the 'from' attribute into an ElementFactory
        // TODO Move to util class
        var element;
        if(ObjectUtils.isString(from)) {

            var elementStr = from;

            if(prefixMapping != null) {
                var prefixes = prefixMapping.getNsPrefixMap();
                //var vars = sparql.extractSparqlVars(elementStr);
                elementStr = PrefixUtils.expandPrefixes(prefixes, elementStr);
            }

            element = new ElementString.create(elementStr);

            //elementFactory = new sparql.ElementFactoryConst(element);
        }
        else if(from instanceof Element) {
            element = from;
        }
//        else if(from instanceof ElementFactory) {
//            throw new Error('ElementFactories / functions in the FROM part not supported anymore');
//        }
        else if(ObjectUtils.isFunction(from)) {
            throw new Error('ElementFactories / functions in the FROM part not supported anymore');
        }
        else {
            throw new Error('Unknown argument type for FROM attribute', from);
        }

        //this.context.mapTableNameToElementFactory(name, elementFactory);

        // TODO The support joining the from element

        var tmp = templateParser.parseAgg(template);

        // Remove the outer most transformation wrapping an AggMap!
        var agg = AggUtils.unwrapAggTransform(tmp);

        // Extract the ID attribute
        var idExpr;


        //var tmp = AggUtils.unwrapAggTransform(agg);
        if(agg instanceof AggMap) {
            var keyBindingMapper = agg.getKeyBindingMapper();
            idExpr = keyBindingMapper.getExpr(); // TODO Check for whether the mapper provides getExpr()
        }
        else {
            throw new Error('Could not obtain ID attribute from aggregator');
        }

        var idVar;
        if(idExpr instanceof ExprVar) {
            idVar = idExpr.asVar();
        }
        else {
            throw new Error('Variable required for ID attribute, got an expression instead: ' + idExpr);
        }

        var concept = new Concept(element, idVar);

        var result = new MappedConcept(concept, agg);
        return result;
    },

};

module.exports = SponateUtils;
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					AKSW
					<br />
					
					
		<span class="copyright">
		AKSW 2014
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Sun Apr 19 2015 19:44:26 GMT+0000 (UTC) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:true,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
